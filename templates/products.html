{% extends "base.html" %}
{% block content %}

<!-- CSS Styles -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<style>
  .product-img {
    height: 220px;
    object-fit: cover;
    cursor: pointer;
  }

  .scroll-container {
    display: flex;
    overflow-x: auto;
    gap: 1rem;
    padding-bottom: 1rem;
  }

  .scroll-container::-webkit-scrollbar {
    height: 8px;
  }

  .scroll-container::-webkit-scrollbar-thumb {
    background-color: #888;
    border-radius: 4px;
  }

  .scroll-container::-webkit-scrollbar-track {
    background: #f1f1f1;
  }

  .card img {
    transition: transform 0.3s ease-in-out;
  }

  .card:hover img {
    transform: scale(1.05);
  }

  footer {
    margin-top: 0 !important;
    padding-top: 0 !important;
  }

  .modal-img {
    width: 90vw;
    height: auto;
    max-height: 90vh;
    object-fit: contain;
  }

  .category-images {
    transition: opacity 0.3s ease-in-out;
  }

  #backToTop {
    display: none;
    position: fixed;
    bottom: 40px;
    right: 30px;
    z-index: 99;
  }
</style>

<!-- Section: Category Buttons -->
<div class="container mt-5">
  <div class="text-center mb-4">
    <h2 class="fw-semibold">Explore by Category</h2>
    <p class="text-muted">Browse our curated collections by room or style</p>
  </div>

  <div class="row">
    <div class="col-md-3 mb-4">
      <div class="list-group" id="category-list">
        {% for cat in ['bedroom', 'living', 'dining', 'office', 'lighting', 'decor', 'sanitaryware', 'tiles', 'outdoor'] %}
          <button class="list-group-item list-group-item-action" data-category="{{ cat }}">{{ cat.title() }}</button>
        {% endfor %}
      </div>
    </div>

    <!-- Product Section (Right Side) -->
    <div class="col-md-9">
      {% for cat in ['bedroom', 'living', 'dining', 'office', 'lighting', 'decor', 'sanitaryware', 'tiles', 'outdoor'] %}
        <div class="category-images" id="{{ cat }}-section" style="display: none;">
          <h4 class="mb-3">{{ cat.title().replace('-', ' ') }}</h4>
          <div class="scroll-container">
            {% for i in range(1, 21) %}
              {% set img_path = 'images/' + cat + '/' + cat + ' ' + i|string + '.jpeg' %}
              <div class="card" style="min-width: 220px;" data-aos="fade-up">
                <img src="{{ url_for('static', filename=img_path) }}"
                     class="img-fluid product-img rounded" alt="{{ cat.title() }} Item {{ i }}"
                     loading="lazy"
                     onclick="openModal(this.src, '{{ cat.title() }} Item {{ i }}')">
                <div class="card-body text-center small">{{ cat.title() }} Item {{ i }}</div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endfor %}

      <!-- Dynamic Catalog Button -->
      <div class="text-center mt-4">
        <a id="catalogLink" href="/catalogs?cat=lighting" class="btn btn-outline-dark">
          View Full Lighting Catalog →
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Modal for Image Preview -->
<div class="modal fade" id="imageModal" tabindex="-1">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content bg-dark">
      <div class="modal-header border-0">
        <h5 class="modal-title text-white" id="imageModalLabel"></h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body d-flex justify-content-center align-items-center">
        <img id="modalImage" class="modal-img" src="" alt="Product Image">
      </div>
    </div>
  </div>
</div>

<!-- Back to Top -->
<button onclick="scrollToTop()" id="backToTop" class="btn btn-dark rounded-circle">
  <i class="fas fa-chevron-up"></i>
</button>

<!-- CTA Section -->
<div class="section text-center bg-dark text-white mt-5 py-5">
  <div class="container" data-aos="fade-up">
    <h2 class="mb-3">Need Help Finding the Right Product?</h2>
    <p class="mb-4">We source directly from top manufacturers and offer complete procurement solutions.</p>
    <a href="/contact" class="btn btn-light btn-lg">Get in Touch</a>
  </div>
</div>

<!-- JS Scripts -->
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
  AOS.init();

  function openModal(src, title) {
    document.getElementById('modalImage').src = src;
    document.getElementById('imageModalLabel').textContent = title;
    new bootstrap.Modal(document.getElementById('imageModal')).show();
  }

  const categoryButtons = document.querySelectorAll('[data-category]');
  const categorySections = document.querySelectorAll('.category-images');

  categoryButtons.forEach(button => {
    button.addEventListener('click', () => {
      const selectedCategory = button.getAttribute('data-category');

      categorySections.forEach(section => section.style.display = 'none');
      document.getElementById(selectedCategory + '-section').style.display = 'block';

      localStorage.setItem('activeCategory', selectedCategory);

      const catalogBtn = document.getElementById('catalogLink');
      const capitalized = selectedCategory.charAt(0).toUpperCase() + selectedCategory.slice(1);
      catalogBtn.innerText = `View Full ${capitalized} Catalog →`;
      catalogBtn.href = `/catalogs?cat=${selectedCategory}`;
    });
  });

  window.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const category = urlParams.get('category');
    const stored = localStorage.getItem('activeCategory');
    const openCategory = category || stored || 'bedroom';

    const btn = document.querySelector(`[data-category="${openCategory}"]`);
    if (btn) btn.click();

    if (!category) localStorage.removeItem('activeCategory');
  });

  window.onscroll = function () {
    const btn = document.getElementById("backToTop");
    btn.style.display = (document.documentElement.scrollTop > 100) ? "block" : "none";
  };

  function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
</script>

{% endblock %}
