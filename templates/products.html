{% extends "base.html" %}
{% block content %}

<!-- AOS CSS -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

<style>
  .product-img {
    height: 220px;
    object-fit: cover;
    cursor: pointer;
  }

  .scroll-container {
    display: flex;
    overflow-x: auto;
    gap: 1rem;
    padding-bottom: 1rem;
  }

  .scroll-container::-webkit-scrollbar {
    height: 8px;
  }

  .scroll-container::-webkit-scrollbar-thumb {
    background-color: #888;
    border-radius: 4px;
  }

  .scroll-container::-webkit-scrollbar-track {
    background: #f1f1f1;
  }

  .card:hover img {
    transform: scale(1.05);
  }

  .card img {
    transition: transform 0.3s ease-in-out;
  }

  .category-images {
    transition: opacity 0.3s ease-in-out;
  }

  .category-images h5 {
    font-weight: 600;
    font-size: 1rem;
    margin-bottom: 0.6rem;
    padding-left: 8px;
    color: #666;
  }

  .mobile-cat-btn.active {
    background-color: #111;
    color: #fff;
    border-color: #111;
  }

  .modal-img {
    width: 90vw;
    height: auto;
    max-height: 90vh;
    object-fit: contain;
  }

  #backToTop {
    display: none;
    position: fixed;
    bottom: 40px;
    right: 30px;
    z-index: 99;
  }
.scroll-container::-webkit-scrollbar {
  display: none;
}
.scroll-container {
  scrollbar-width: none; /* Firefox */
}

  /* Mobile view */
  @media (max-width: 768px) {
  .container {
    padding: 0 8px;
  }

  #category-list {
    display: none !important;
  }

  .mobile-cat-btn {
    font-size: 0.85rem;
    padding: 6px 12px;
    border-radius: 20px;
    white-space: nowrap;
    transition: all 0.3s;
  }

  #mobileCategoryScroll {
    scrollbar-width: none;
  }

  #mobileCategoryScroll::-webkit-scrollbar {
    display: none;
  }

  .scroll-container {
    flex-wrap: wrap;
    justify-content: center;
    overflow-x: hidden;
    gap: 16px;
    padding: 0;
    margin: 0;
  }

  .scroll-container .card {
    flex: 0 0 100%;
    background: none;
    border: none;
    border-radius: 0;
    box-shadow: none;
    padding: 0;
  }

  .scroll-container .product-img {
    width: 100%;
    height: 280px;
    object-fit: cover;
    border-radius: 0;
  }

  .card-body {
    padding: 6px 4px;
    text-align: center;
    font-size: 0.9rem;
    color: #444;
  }

  .category-images {
    display: none !important;
  }

  .category-images.active {
    display: block !important;
  }

  .category-images h5 {
    padding-left: 0;
    font-weight: 500;
    font-size: 0.95rem;
    margin-top: 1rem;
    margin-bottom: 0.4rem;
    text-align: center;
  }
}


</style>

<div class="container mt-5">
  <div class="text-center mb-4">
    <h2 class="fw-semibold">Explore by Category</h2>
    <p class="text-muted">Browse our curated collections by room or style</p>
  </div>

  <div class="row">
    <!-- Sidebar Category Buttons (Desktop) -->
    <div class="col-md-3 mb-4 d-none d-md-block" id="category-list">
      <div class="list-group">
        {% for cat, data in product_images.items() %}
        <button class="list-group-item list-group-item-action" data-category="{{ cat }}">
          {{ data.display_name }}
        </button>
        {% endfor %}
      </div>
    </div>

    <!-- Horizontal Scroll Category Buttons (Mobile) -->
    <div class="d-md-none px-2 mb-3">
      <div class="d-flex overflow-auto gap-2 pb-2" id="mobileCategoryScroll">
        {% for cat, data in product_images.items() %}
        <button class="btn btn-outline-dark btn-sm flex-shrink-0 mobile-cat-btn" data-category="{{ cat }}">
          {{ data.display_name }}
        </button>
        {% endfor %}
      </div>
    </div>

    <!-- Product Display Area -->
    <div class="col-md-9 order-1 order-md-2">
      {% for cat, data in product_images.items() %}
      <div class="category-images" id="{{ cat }}-section" style="display: none;">
        <h5 class="text-muted text-start mt-4 mb-2">{{ data.display_name }}</h5>
        <div class="scroll-container">
          {% for item in data["items"] %}
          <div class="card" style="min-width: 220px;" data-aos="fade-up">
            <img src="{{ url_for('static', filename='images/' + cat + '/' + item.filename) }}"
              class="img-fluid product-img rounded" alt="{{ item.code }}"
              loading="lazy" onclick="openModal(this.src, '{{ item.code }}')">
            <div class="card-body text-center small">{{ item.code }}</div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="col-12 order-3 mt-4 text-center">
      <a id="catalogLink" href="/catalogs?cat=lighting" class="btn btn-outline-dark">
        View Full Lighting Catalog →
      </a>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="imageModal" tabindex="-1">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content bg-dark">
      <div class="modal-header border-0">
        <h5 class="modal-title text-white" id="imageModalLabel"></h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body d-flex justify-content-center align-items-center">
        <img id="modalImage" class="modal-img" src="" alt="Product Image">
      </div>
    </div>
  </div>
</div>

<!-- CTA -->
<div class="section text-center bg-dark text-white mt-5 py-5">
  <div class="container" data-aos="fade-up">
    <h2 class="mb-3">Need Help Finding the Right Product?</h2>
    <p class="mb-4">We source directly from top manufacturers and offer complete procurement solutions.</p>
    <a href="/contact" class="btn btn-light btn-lg">Get in Touch</a>
  </div>
</div>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
  AOS.init();

  function openModal(src, title) {
    document.getElementById('modalImage').src = src;
    document.getElementById('imageModalLabel').textContent = title;
    new bootstrap.Modal(document.getElementById('imageModal')).show();
  }

  const categoryButtons = document.querySelectorAll('[data-category]');
  const categorySections = document.querySelectorAll('.category-images');

  categoryButtons.forEach(button => {
    button.addEventListener('click', () => {
      const selected = button.getAttribute('data-category');
      categorySections.forEach(section => section.style.display = 'none');
      const section = document.getElementById(selected + '-section');
      if (section) section.style.display = 'block';

      localStorage.setItem('activeCategory', selected);
      document.getElementById('catalogLink').innerText = `View Full ${selected.charAt(0).toUpperCase() + selected.slice(1)} Catalog →`;
      document.getElementById('catalogLink').href = `/catalogs?cat=${selected}`;

      categoryButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
    });
  });

  window.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const category = urlParams.get('category') || localStorage.getItem('activeCategory') || Object.keys({{ product_images|tojson }}).at(0);
    const btn = document.querySelector(`[data-category="${category}"]`);
    if (btn) btn.click();
  });

  // Enable horizontal scroll with mouse wheel
  document.querySelectorAll('.scroll-container').forEach(container => {
    container.addEventListener('wheel', function (e) {
      if (e.deltaY !== 0) {
        e.preventDefault();
        container.scrollLeft += e.deltaY;
      }
    }, { passive: false });
  });
</script>

{% endblock %}
