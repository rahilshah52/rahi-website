{% extends "base.html" %}
{% block content %}

<!-- CSS Styles -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<style>
  .product-img {
    height: 220px;
    object-fit: cover;
    cursor: pointer;
  }

  .scroll-container {
    display: flex;
    overflow-x: auto;
    gap: 1rem;
    padding-bottom: 1rem;
  }

  .scroll-container::-webkit-scrollbar {
    height: 8px;
  }

  .scroll-container::-webkit-scrollbar-thumb {
    background-color: #888;
    border-radius: 4px;
  }

  .scroll-container::-webkit-scrollbar-track {
    background: #f1f1f1;
  }

  .card img {
    transition: transform 0.3s ease-in-out;
  }

  .card:hover img {
    transform: scale(1.05);
  }

  footer {
    margin-top: 0 !important;
    padding-top: 0 !important;
  }

  .modal-img {
    width: 90vw;
    height: auto;
    max-height: 90vh;
    object-fit: contain;
  }

  .category-images {
    transition: opacity 0.3s ease-in-out;
  }

  #backToTop {
    display: none;
    position: fixed;
    bottom: 40px;
    right: 30px;
    z-index: 99;
  }

@media (max-width: 768px) {
  #category-list {
    display: none !important; /* hide sidebar category */
  }

  .mobile-cat-btn.active {
    background-color: #111;
    color: #fff;
    border-color: #111;
  }

  .scroll-container {
    flex-wrap: wrap;
    gap: 14px;
    overflow-x: hidden;
    justify-content: space-between;
  }

  .scroll-container .card {
    flex: 0 0 48%;
    background: white;
    border-radius: 10px;
    padding: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  }

  .scroll-container .product-img {
    height: 160px;
    border-radius: 10px;
    width: 100%;
    object-fit: cover;
  }

  .category-images {
    display: none !important;
  }

  .category-images.active {
    display: block !important;
  }

  .category-images h5 {
    font-weight: 600;
    font-size: 1rem;
    margin-bottom: 0.6rem;
    padding-left: 8px;
    color: #666;
  }

  /* CTA section spacing fix */
  .section.text-center {
    padding-top: 3rem !important;
  }
}

@media (max-width: 768px) {
  .mobile-cat-btn {
    font-size: 0.85rem;
    padding: 6px 12px;
    border-radius: 20px;
    white-space: nowrap;
    transition: all 0.3s;
  }

  #mobileCategoryScroll {
    scrollbar-width: none; /* Firefox */
  }

  #mobileCategoryScroll::-webkit-scrollbar {
    display: none; /* Chrome */
  }
}


</style>

<!-- Section: Category Buttons -->
<div class="container mt-5">
  <div class="text-center mb-4">
    <h2 class="fw-semibold">Explore by Category</h2>
    <p class="text-muted">Browse our curated collections by room or style</p>
  </div>

  <div class="row">
 <!-- MOBILE HORIZONTAL CATEGORY SCROLL (Only shown on mobile) -->
<div class="d-md-none px-2 mb-3">
  <div class="d-flex overflow-auto gap-2 pb-2" id="mobileCategoryScroll">
    {% for cat, data in product_images.items() %}
    <button class="btn btn-outline-dark btn-sm flex-shrink-0 mobile-cat-btn" data-category="{{ cat }}">
      {{ data.display_name }}
    </button>
    {% endfor %}
  </div>
</div>


  <!-- PRODUCT IMAGES -->
  <div class="col-md-9 order-1 order-md-2">
    {% for cat, data in product_images.items() %}
      <div class="category-images" id="{{ cat }}-section" style="display: none;">
        <h5 class="text-muted text-start mt-4 mb-2" style="font-size: 1rem;">{{ data.display_name }}</h5>
        <div class="scroll-container">
          {% for item in data["items"] %}
          <div class="card" style="min-width: 220px;" data-aos="fade-up">
            <img src="{{ url_for('static', filename='images/' + cat + '/' + item.filename) }}"
                 class="img-fluid product-img rounded"
                 alt="{{ item.code }}"
                 loading="lazy"
                 onclick="openModal(this.src, '{{ item.code }}')">
            <div class="card-body text-center small">{{ item.code }}</div>
          </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- VIEW CATALOG BUTTON -->
  <div class="col-12 order-3 mt-4 text-center">
    <a id="catalogLink" href="/catalogs?cat=lighting" class="btn btn-outline-dark">
      View Full Lighting Catalog →
    </a>
  </div>
</div>

<!-- Modal for Image Preview -->
<div class="modal fade" id="imageModal" tabindex="-1">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content bg-dark">
      <div class="modal-header border-0">
        <h5 class="modal-title text-white" id="imageModalLabel"></h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body d-flex justify-content-center align-items-center">
        <img id="modalImage" class="modal-img" src="" alt="Product Image">
      </div>
    </div>
  </div>
</div>

<!-- Back to Top -->
<button onclick="scrollToTop()" id="backToTop" class="btn btn-dark rounded-circle">
  <i class="fas fa-chevron-up"></i>
</button>

<!-- CTA Section -->
<div class="section text-center bg-dark text-white mt-5 py-5">
  <div class="container" data-aos="fade-up">
    <h2 class="mb-3">Need Help Finding the Right Product?</h2>
    <p class="mb-4">We source directly from top manufacturers and offer complete procurement solutions.</p>
    <a href="/contact" class="btn btn-light btn-lg">Get in Touch</a>
  </div>
</div>

<!-- JS Scripts -->
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
  AOS.init();

  function openModal(src, title) {
    document.getElementById('modalImage').src = src;
    document.getElementById('imageModalLabel').textContent = title;
    new bootstrap.Modal(document.getElementById('imageModal')).show();
  }

  const categoryButtons = document.querySelectorAll('[data-category]');
  const categorySections = document.querySelectorAll('.category-images');

  categoryButtons.forEach(button => {
    button.addEventListener('click', () => {
      const selectedCategory = button.getAttribute('data-category');
      categorySections.forEach(section => {
        section.classList.remove("active");
        section.style.display = 'none';
      });
      const target = document.getElementById(selectedCategory + '-section');
      if (target) {
        target.style.display = 'block';
        setTimeout(() => target.classList.add("active"), 10);
      }

      localStorage.setItem('activeCategory', selectedCategory);

      const catalogBtn = document.getElementById('catalogLink');
      const capitalized = selectedCategory.charAt(0).toUpperCase() + selectedCategory.slice(1);
      catalogBtn.innerText = `View Full ${capitalized} Catalog →`;
      catalogBtn.href = `/catalogs?cat=${selectedCategory}`;

      categoryButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
    });
  });

  window.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const category = urlParams.get('category');
    const stored = localStorage.getItem('activeCategory');
    const openCategory = category || stored || 'bedroom';
    const btn = document.querySelector(`[data-category="${openCategory}"]`);
    if (btn) btn.click();
    if (!category) localStorage.removeItem('activeCategory');
  });

  window.onscroll = function () {
    const btn = document.getElementById("backToTop");
    btn.style.display = (document.documentElement.scrollTop > 100) ? "block" : "none";
  };

  function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  document.querySelectorAll('.scroll-container').forEach(container => {
    container.addEventListener('wheel', function (e) {
      if (e.deltaY !== 0) {
        e.preventDefault();
        container.scrollLeft += e.deltaY;
      }
    }, { passive: false });
  });


// MOBILE: tap to switch category view
if (window.innerWidth <= 768) {
  const mobileButtons = document.querySelectorAll('.mobile-cat-btn');
  mobileButtons.forEach(button => {
    button.addEventListener('click', () => {
      const selected = button.getAttribute('data-category');
      document.querySelectorAll('.category-images').forEach(section => {
        section.classList.remove('active');
      });
      document.querySelector(`#${selected}-section`)?.classList.add('active');

      mobileButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
    });
  });

  // Optionally show first category by default
  mobileButtons[0]?.click();
}

</script>

{% endblock %}
